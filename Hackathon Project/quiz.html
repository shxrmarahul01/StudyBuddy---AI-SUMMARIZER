<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF + YouTube Summarizer + Quiz</title>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js"></script>

  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --muted:#94a3b8;
      --accent:#7c3aed; --accent-2:#4f3aed; --glass:rgba(255,255,255,0.04);
      --radius:12px; color-scheme: dark; font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto;
    }

    html,body{
      height:100%;
      margin:0;
      background:linear-gradient(180deg,var(--bg),#071027);
      color:#e6eef8;
    }

    .wrap{max-width:1100px;margin:28px auto;padding:22px}
    header{display:flex;gap:18px;align-items:center;margin-bottom:18px}
    .logo{
      width:56px;height:56px;border-radius:12px;
      background:linear-gradient(135deg,#4f46e5,#06b6d4);
      display:flex;align-items:center;justify-content:center;
      font-weight:700;font-size:20px;
    }

    .grid{display:grid;grid-template-columns:380px 1fr;gap:18px}
    @media (max-width:980px){ .grid{grid-template-columns:1fr} }

    .card{
      background:linear-gradient(180deg, rgba(255,255,255,0.02), var(--card));
      padding:16px;border-radius:var(--radius);margin-bottom:20px
    }

    .file-drop{
      border:1px dashed rgba(255,255,255,0.06);
      padding:14px;border-radius:10px;background:var(--glass);
      display:flex;flex-direction:column;gap:8px;align-items:center;cursor:pointer
    }

    .btn{
      background:linear-gradient(90deg, var(--accent), var(--accent-2));
      padding:10px 14px;border:none;border-radius:10px;color:white;
      font-weight:600;cursor:pointer;transition:0.18s
    }

    .btn.ghost{
      background:rgba(124,58,237,0.1);
      border:1px solid rgba(124,58,237,0.26)
    }

    textarea{
      width:100%;min-height:140px;padding:12px;border-radius:10px;
      background:transparent;border:1px solid rgba(255,255,255,0.04);
      color:inherit
    }

    .quiz-card{
      padding:10px;background:rgba(255,255,255,0.04);border-radius:10px;margin-top:12px
    }

    .question{
      padding:10px;background:rgba(0,0,0,0.18);border-radius:8px;margin-bottom:8px
    }

    .option-label{
      display:flex;gap:10px;align-items:center;padding:8px;border-radius:8px;cursor:pointer
    }

    .meta{color:var(--muted);font-size:13px}
    .correct{color:#90ee90;font-weight:700}
    .wrong{color:#ff8080;font-weight:700}
    #rawText b{color:#ffd166}
  </style>
</head>

<body>
<div class="wrap">

<header>
  <div class="logo">PS</div>
  <div>
    <h1>PDF & YouTube Summarizer + MCQ Quiz</h1>
    <p class="small">Upload a PDF or paste a YouTube link to create summaries and quizzes.</p>
  </div>
</header>

<main class="grid">

<!-- LEFT SIDE -->
<section class="card">

  <h2>Upload PDF</h2>

  <div id="drop" class="file-drop">
    <div>Click or drop a PDF here</div>
    <div id="fileName" class="small">No file selected</div>
  </div>

  <input id="pdfUpload" type="file" accept="application/pdf" style="display:none">

  <label class="small" style="margin-top:12px">
    Summary length
    <select id="summaryLen" style="margin-left:8px">
      <option value="3">Short</option>
      <option value="5" selected>Medium</option>
      <option value="8">Long</option>
    </select>
  </label>

  <div style="margin-top:12px;display:flex;gap:8px">
    <button id="extractBtn" class="btn">Extract & Summarize</button>
    <button id="downloadBtn" class="btn ghost">Download .txt</button>
  </div>

  <hr style="margin:14px 0">

  <h2>YouTube Video Summarizer</h2>

  <input id="ytLink" placeholder="Paste YouTube link" 
    style="width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />

  <div style="margin-top:8px;display:flex;gap:8px">
    <button id="ytSummBtn" class="btn">Fetch & Summarize</button>
    <button id="ytManualBtn" class="btn ghost">Use Pasted Transcript</button>
  </div>

  <textarea id="ytTranscript" placeholder="Paste transcript here..." style="margin-top:10px"></textarea>

</section>

<!-- RIGHT SIDE -->
<section class="card">

  <h2>Summary</h2>

  <textarea id="summaryOutput" placeholder="Summary will appear here..."></textarea>

  <button id="copyBtn" class="btn ghost" style="margin-top:10px">Copy Summary</button>

  <div style="display:flex;gap:8px;align-items:center;margin-top:12px">
    <button id="generateQuizBtn" class="btn">Generate Quiz (10)</button>
    <button id="resetQuizBtn" class="btn ghost" disabled>Reset</button>
    <button id="copyAnswersBtn" class="btn ghost" disabled>Copy Keys</button>
  </div>

  <div id="quizArea" class="quiz-card" style="display:none"></div>
  <div id="resultArea" class="quiz-card" style="display:none"></div>

</section>

</main>

<!-- EXPLANATION AREA -->
<section class="card" style="margin-top:18px">
  <h2>Answer Explanations</h2>
  <div id="rawText" style="max-height:300px;overflow:auto;font-size:13px">No Answers Yet...Go And Play Quiz.</div>
</section>

</div>


<script>
/* PDF worker */
pdfjsLib.GlobalWorkerOptions.workerSrc =
  "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";

let currentFile = null;
let lastExtractedText = "";
let latestQuiz = [];

/* DOM refs */
const drop = document.getElementById("drop");
const fileInput = document.getElementById("pdfUpload");
const extractBtn = document.getElementById("extractBtn");
const summaryOutput = document.getElementById("summaryOutput");
const rawTextEl = document.getElementById("rawText");
const fileNameEl = document.getElementById("fileName");

/* File events */
drop.addEventListener("click", () => fileInput.click());
drop.addEventListener("dragover", e => e.preventDefault());
drop.addEventListener("drop", e => {
  e.preventDefault();
  handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener("change", e => handleFile(e.target.files[0]));

function handleFile(file){
  if (!file || file.type !== "application/pdf") return;
  currentFile = file;
  fileNameEl.textContent = file.name;
  rawTextEl.textContent = "Ready to extract — click Extract.";
  summaryOutput.value = "";
  lastExtractedText = "";
}

/* Extract PDF */
extractBtn.addEventListener("click", async () => {
  if (!currentFile) return alert("Upload a PDF first.");

  extractBtn.disabled = true;
  extractBtn.textContent = "Extracting...";

  try {
    const typed = new Uint8Array(await currentFile.arrayBuffer());
    const pdf = await pdfjsLib.getDocument(typed).promise;

    let extracted = "";
    for (let i = 1; i <= pdf.numPages; i++) {
      const page = await pdf.getPage(i);
      const text = await page.getTextContent();
      extracted += text.items.map(x => x.str).join(" ") + "\n\n";
    }

    lastExtractedText = extracted;
    const len = parseInt(document.getElementById("summaryLen").value, 10);
    summaryOutput.value = hybridSummary(extracted, len * 3);

  } catch {
    alert("PDF extraction failed.");
  }

  extractBtn.disabled = false;
  extractBtn.textContent = "Extract & Summarize";
});

/* Summarizer */
function hybridSummary(text, max=12){
  text = text.replace(/\s+/g," ");
  const chunks = text.split(/(?<=[.!?])\s+/).filter(s=>s.length>40);

  const words = text.toLowerCase().match(/\b[a-z]{4,}\b/g) || [];
  const freq = {};
  words.forEach(w => freq[w] = (freq[w]||0)+1);

  const scored = chunks.map(c=>{
    const ws = c.toLowerCase().match(/\b[a-z]{4,}\b/g)||[];
    const score = ws.reduce((s,w)=>s+(freq[w]||0),0);
    return {chunk:c,score};
  });

  return scored.sort((a,b)=>b.score-a.score)
               .slice(0,max)
               .map(x=>"• "+x.chunk)
               .join("\n\n");
}

/* YouTube transcript */
document.getElementById("ytManualBtn").addEventListener("click", ()=>{
  const t = document.getElementById("ytTranscript").value.trim();
  if (!t) return alert("Paste transcript first.");
  summaryOutput.value = hybridSummary(t, 10);
});

/* Copy summary */
document.getElementById("copyBtn").addEventListener("click", async ()=>{
  await navigator.clipboard.writeText(summaryOutput.value);
});

/* Quiz */

const quizArea = document.getElementById("quizArea");
const resultArea = document.getElementById("resultArea");
const generateQuizBtn = document.getElementById("generateQuizBtn");
const resetQuizBtn = document.getElementById("resetQuizBtn");
const copyAnswersBtn = document.getElementById("copyAnswersBtn");

function splitSentences(t){
  return t.replace(/\s+/g," ")
          .split(/(?<=[.!?])\s+/)
          .filter(s=>s.length>40);
}

function extractKeywords(text, limit=50){
  const words=text.toLowerCase().match(/\b[a-z]{5,}\b/g)||[];
  const freq={};
  words.forEach(w=>freq[w]=(freq[w]||0)+1);
  return Object.entries(freq)
               .sort((a,b)=>b[1]-a[1])
               .slice(0,limit)
               .map(e=>e[0]);
}

function shuffle(a){return a.sort(()=>Math.random()-0.5)}

function generateExplanation(sentence, word){
  return `
    The correct word is <b>${word}</b> because in the sentence:
    "<i>${sentence}</i>"
    the blank refers logically to <b>${word}</b>, which fits the meaning,
    grammar, and context of the statement.
  `;
}

/* Build quiz */
generateQuizBtn.addEventListener("click", ()=>{
  const text = lastExtractedText || summaryOutput.value;
  latestQuiz = buildQuiz(text);
  renderQuiz(latestQuiz);

  quizArea.style.display = "block";
  resetQuizBtn.disabled = false;
  copyAnswersBtn.disabled = false;
});

function buildQuiz(text){
  const sents = splitSentences(text);
  const keys = extractKeywords(text, 60);

  const quiz=[];
  const used=new Set();

  let tries=0;
  while(quiz.length<10 && tries<400){
    tries++;
    const s = sents[Math.floor(Math.random()*sents.length)];
    const word = keys.find(k=>!used.has(k) && new RegExp("\\b"+k+"\\b","i").test(s));
    if (!word) continue;

    used.add(word);

    quiz.push({
      question: s.replace(new RegExp("\\b"+word+"\\b","i"), "______"),
      correct: word,
      options: shuffle([word, ...shuffle(keys.filter(k=>k!==word)).slice(0,3)]),
      explanation: generateExplanation(s, word),
      original: s
    });
  }
  return quiz;
}

/* Render quiz — WITH SUBMIT BUTTON AT BOTTOM */
function renderQuiz(quiz){
  quizArea.innerHTML="";

  quiz.forEach((q,i)=>{
    const div=document.createElement("div");
    div.className="question";

    div.innerHTML = `<b>${i+1}.</b> ${q.question}<br><br>`;

    q.options.forEach(opt=>{
      div.innerHTML += `
        <label class="option-label">
          <input type="radio" name="q${i}" value="${opt}">
          ${opt}
        </label>
      `;
    });

    quizArea.appendChild(div);
  });

  /* Submit button at bottom */
  const submitBtn = document.createElement("button");
  submitBtn.textContent = "Submit Quiz";
  submitBtn.className = "btn";
  submitBtn.style.marginTop = "14px";
  submitBtn.onclick = submitQuiz;

  quizArea.appendChild(submitBtn);
}

/* Submit quiz */
function submitQuiz(){
  let correct=0;

  let explanationHTML = `<h3>Answer Solutions</h3>`;

  latestQuiz.forEach((q,i)=>{
    const selected = document.querySelector(`input[name="q${i}"]:checked`);
    const user = selected ? selected.value : null;
    const ok = user && user.toLowerCase() === q.correct.toLowerCase();

    if(ok) correct++;

    explanationHTML += `
      <div style="padding:10px;margin-bottom:10px;background:rgba(255,255,255,0.05);border-radius:10px;">
        <b>${i+1}. ${q.question}</b><br><br>

        <div class="${ok ? "correct" : "wrong"}">
          Your answer: ${user ? user : "<i>No answer</i>"} — ${ok ? "Correct" : "Incorrect"}
        </div>

        <div><strong>Correct answer:</strong> ${q.correct}</div>

        <div style="margin-top:6px"><strong>Explanation:</strong><br>${q.explanation}</div>

        <div style="margin-top:6px">
          <strong>Original sentence:</strong><br>
          ${q.original.replace(new RegExp("\\b"+q.correct+"\\b","i"), "<b>"+q.correct+"</b>")}
        </div>
      </div>
    `;
  });

  resultArea.style.display="block";
  resultArea.innerHTML = `<h3>Score: ${correct} / ${latestQuiz.length}</h3>`;

  rawTextEl.innerHTML = explanationHTML;
}

/* Copy answers */
copyAnswersBtn.addEventListener("click", async ()=>{
  const text = latestQuiz.map((q,i)=> `${i+1}. ${q.correct}`).join("\n");
  await navigator.clipboard.writeText(text);
  alert("Answer key copied!");
});

/* Reset page */
resetQuizBtn.addEventListener("click", ()=> location.reload());

</script>

</body>
</html>
